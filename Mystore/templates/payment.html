<!DOCTYPE html>
<html>
<head>
    <title>Payment Form</title>
    <!-- Include your CSS stylesheets here -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="payment-form">
        <h1>Payment Information</h1>
        <form id="payment-form" action="{{ url_for('payments.process_payment', file_identifier=file_identifier) }}" method="POST">
            <div class="form-section">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-section">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-section">
                <label for="amount">Amount:</label>
                <input type="text" id="amount" name="amount" required>
            </div>
            <div class="form-section">
                <h2>Items in Cart:</h2>
                <ul id="cart-items">
                    <li>{{ file_identifier }}</li>
                </ul>
            </div>
            <button id="pay-button">Proceed to Payment</button>
        </form>
    </div>
</body>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const payButton = document.getElementById('pay-button');
        const cartItemsList = document.getElementById('cart-items');
        const emailInput = document.getElementById('email'); // Get the email input element

        // Retrieve the file identifier from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const fileIdentifier = urlParams.get('file_identifier');

        // Modify the amount and email as needed
        const amountInKobo = 752500; // Modify the amount as needed

        payButton.addEventListener('click', function(event) {
            event.preventDefault();

            const email = emailInput.value; // Get the entered email value

            // Check if the entered email is valid
            if (!isValidEmail(email)) {
                alert('Please enter a valid email address.');
                return;
            }

            // Construct PaystackPop setup
            const paystack = PaystackPop.setup({
                key: 'pk_test_60a3e1f9abc3bbe710308289a796d2e7b6f428ad', // Your Public Key
                email: email,
                amount: amountInKobo,
                currency: 'NGN',
                ref: `paystack_example_${Date.now()}`,
                callback: function(response) {
                    // Handle the response after payment
                    console.log(response);
                    if (response.status === 'success') {
                        // Display success message to the user
                        alert('Payment successful!');
                        // Redirect to the payment successful page
                        window.location.href = `/success/${fileIdentifier}`;
                    }
                }
            });

            // Open the Paystack payment modal
            paystack.openIframe();
        });

        // Function to validate email format
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
    });
</script>
</html>
